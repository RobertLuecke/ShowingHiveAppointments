<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>{{ property['name'] }} – ShowingHive</title>
    <style>
        /* ShopProp blue branding */
        :root {
            --primary-color: #1E90FF;
            --primary-hover: #0d6efd;
        }
        body {
            font-family: sans-serif;
            margin: 2rem;
        }
        h1, h2, h3 {
            color: var(--primary-color);
        }
        section {
            margin-bottom: 2rem;
        }
        ul {
            list-style-type: none;
            padding-left: 0;
        }
        li {
            margin-bottom: 0.5rem;
        }
        form.inline {
            display: inline;
            margin-right: 0.5rem;
        }
        a {
            color: var(--primary-color);
        }
        button {
            background-color: var(--primary-color);
            color: #ffffff;
            border: none;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: var(--primary-hover);
        }
        input[type="text"], input[type="email"] {
            padding: 0.3rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }
        select {
            padding: 0.3rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Authentication links -->
    <p style="text-align: right; font-size: 0.9rem;">
        {% if current_user.is_authenticated %}
            Logged in as {{ current_user.username }} | <a href="{{ url_for('logout') }}">Logout</a>
        {% else %}
            <a href="{{ url_for('login') }}">Login</a> | <a href="{{ url_for('register') }}">Register</a>
        {% endif %}
    </p>
    <!-- Logo -->
    <img src="{{ url_for('static', filename='showinghive_logo.jpg') }}" alt="ShowingHive Logo" style="height: 80px;">
    <h1>{{ property['name'] }}</h1>
    <p>{{ property['address'] }}</p>

    <section>
        <h2>Schedule a Showing</h2>
        <form method="post" action="{{ url_for('ui_schedule_showing', property_id=property['id']) }}">
            <label>Client Name: <input type="text" name="client_name" required></label><br>
            <label>Client Phone: <input type="text" name="client_phone"></label><br>
            <label>Client Email: <input type="email" name="client_email"></label><br>
            <label>Scheduled At: <input type="text" name="scheduled_at" placeholder="YYYY-MM-DDTHH:MM" required></label><br>
            <button type="submit">Request Showing</button>
        </form>
    </section>

    <section>
        <h2>Available Slots (Next 7 Days)</h2>
        <p>Select a slot below to request a showing. Unavailable slots are grayed out.</p>
        <table style="width:100%; border-collapse: collapse;">
            <thead>
                <tr>
                    <th style="text-align:left; padding:0.5rem; border-bottom: 1px solid #ccc;">Date</th>
                    <th style="text-align:left; padding:0.5rem; border-bottom: 1px solid #ccc;">Times</th>
                </tr>
            </thead>
            <tbody>
            {% for day in week_slots %}
                <tr>
                    <td style="vertical-align: top; padding:0.5rem; border-bottom: 1px solid #eee; width: 150px;">{{ day.date }}</td>
                    <td style="padding:0.5rem; border-bottom: 1px solid #eee;">
                        {% for slot in day.times %}
                            {% if slot.available %}
                                <a href="{{ url_for('ui_schedule_slot', property_id=property['id'], scheduled_at=slot.iso) }}" style="margin-right:8px; color: var(--primary-color); text-decoration: none;">{{ slot.label }}</a>
                            {% else %}
                                <span style="margin-right:8px; color:#ccc;">{{ slot.label }}</span>
                            {% endif %}
                        {% endfor %}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </section>

    <section>
        <h2>Showings</h2>
        <ul>
        {% for s in showings %}
            <li>
                {{ s['scheduled_at'].strftime('%Y-%m-%d %H:%M') }} – {{ s['client_name'] }} – Status: {{ s['status'] }}
                {% if s['status'] == 'pending' %}
                    <form method="post" action="{{ url_for('ui_approve_showing', showing_id=s['id']) }}" class="inline">
                        <button type="submit">Approve</button>
                    </form>
                    <form method="post" action="{{ url_for('ui_decline_showing', showing_id=s['id']) }}" class="inline">
                        <button type="submit">Decline</button>
                    </form>
                    <form method="post" action="{{ url_for('ui_reschedule_showing', showing_id=s['id']) }}" class="inline">
                        <input type="text" name="new_time" placeholder="YYYY-MM-DDTHH:MM" required>
                        <button type="submit">Reschedule</button>
                    </form>
                {% endif %}
                {% if s['status'] == 'approved' %}
                    <span>Lockbox: {{ s.get('lockbox_code') }} (expires {{ s.get('code_expires_at').strftime('%Y-%m-%d %H:%M') if s.get('code_expires_at') else '' }})</span>
                {% endif %}
            </li>
        {% else %}
            <li>No showings scheduled.</li>
        {% endfor %}
        </ul>
    </section>

    <section>
        <h2>Blocked Times</h2>
        <p>The property is generally available between 8am and 8pm each day.  Use this section to block
        additional times when showings should not be scheduled.</p>
        <ul>
        {% for block in blocks %}
            <li>{{ block[0].strftime('%Y-%m-%d %H:%M') }} – {{ block[1].strftime('%Y-%m-%d %H:%M') }}</li>
        {% else %}
            <li>No blocked times.</li>
        {% endfor %}
        </ul>
        <h3>Add Blocked Time Range</h3>
        <form method="post" action="{{ url_for('ui_add_block_time', property_id=property['id']) }}">
            <label>Start: <input type="datetime-local" name="start" required></label><br>
            <label>End: <input type="datetime-local" name="end" required></label><br>
            <button type="submit">Block Time</button>
        </form>
    </section>

    <section>
        <h2>Disclosures</h2>
        <h3>Upload Document</h3>
        <form method="post" action="{{ url_for('ui_upload_disclosure', property_id=property['id']) }}" enctype="multipart/form-data">
            <input type="file" name="file" required>
            <button type="submit">Upload</button>
        </form>
        <p>Files: {% for f in files %}{{ f }} {% endfor %}</p>
        <h3>Create Package</h3>
        <form method="post" action="{{ url_for('ui_create_package', property_id=property['id']) }}">
            <label>Package Name: <input type="text" name="name" required></label><br>
            <label>Files (comma separated): <input type="text" name="files" placeholder="file1.pdf,file2.pdf" required></label><br>
            <label><input type="checkbox" name="is_public"> Public</label><br>
            <button type="submit">Create Package</button>
        </form>
        <h3>Packages</h3>
        <ul>
        {% for pkg in packages %}
            <li>{{ pkg['name'] }} (ID: {{ pkg['id'] }}) – Files: {{ ', '.join(pkg['files']) }} – Public: {{ 'Yes' if pkg['is_public'] else 'No' }}</li>
        {% else %}
            <li>No packages created.</li>
        {% endfor %}
        </ul>
        <h3>Request Disclosure Package</h3>
        <form method="post" action="{{ url_for('ui_request_disclosure', property_id=property['id']) }}">
            <label>Package:
                <select name="package_id" required>
                    {% for pkg in packages %}
                        <option value="{{ pkg['id'] }}">{{ pkg['name'] }}</option>
                    {% endfor %}
                </select>
            </label><br>
            <label>Buyer Name: <input type="text" name="buyer_name" required></label><br>
            <label>Buyer Phone: <input type="text" name="buyer_phone"></label><br>
            <label>Buyer Email: <input type="email" name="buyer_email"></label><br>
            <button type="submit">Request Package</button>
        </form>
        <h3>Shares</h3>
        <ul>
        {% for sh in shares %}
            <li>
                ID: {{ sh['id'] }} – Buyer: {{ sh['buyer_name'] }} – Approved: {{ 'Yes' if sh['approved'] else 'No' }}
                {% if not sh['approved'] %}
                    <form method="post" action="{{ url_for('ui_approve_share', share_id=sh['id']) }}" class="inline">
                        <button type="submit">Approve</button>
                    </form>
                {% endif %}
            </li>
        {% else %}
            <li>No shares yet.</li>
        {% endfor %}
        </ul>
    </section>

    <p><a href="{{ url_for('ui_home') }}">Back to Home</a></p>
</body>
</html>